
CXXFLAGS=-c -std=c++11 -g2 -I$(HOME)/CUnitHome/include -DUSE_CUNIT=1 -I. -I../support -MMD
LDFLAGS=$(HOME)/CUnitHome/lib/libcunit.a

all: test_boiler test_power_manager test_blinky

generated_test_power_manager.cc: power_manager.sm
	@echo "------------ generate code"
	cpp power_manager.sm > /tmp/power_manager.sm
	python3 ../src/generate.py /tmp/power_manager.sm -path:../templates
	astyle generated_state_machine_power_manager.hpp
	astyle generated_test_power_manager.cc

generated_test_blinky.cc: blinky.sm
	@echo "------------ generate code"
	cpp blinky.sm > /tmp/blinky.sm
	python3 ../src/generate.py /tmp/blinky.sm -path:../templates
	astyle generated_state_machine_blinky.hpp
	astyle generated_test_blinky.cc

generated_test_boiler.cc: boiler.sm
	@echo "------------ generate code"
	cpp boiler.sm > /tmp/boiler.sm
	python3 ../src/generate.py /tmp/boiler.sm -path:../templates
	astyle generated_state_machine_boiler.hpp
	astyle generated_test_boiler.cc

-include generated_test_blinky.d generated_test_power_manager.d	main_boiler.d support_statemachine.d generated_test_boiler.d	main_blinky.d main_power_manager.d

test_power_manager: generated_test_power_manager.o main_power_manager.o support_statemachine.o
	g++ -o test_power_manager main_power_manager.o generated_test_power_manager.o support_statemachine.o $(LDFLAGS)

test_boiler: generated_test_boiler.o main_boiler.o support_statemachine.o
	g++ -o test_boiler main_boiler.o generated_test_boiler.o support_statemachine.o $(LDFLAGS)


test_blinky: generated_test_blinky.o main_blinky.o support_statemachine.o
	g++ -o test_blinky main_blinky.o generated_test_blinky.o support_statemachine.o $(LDFLAGS)



clean:
	rm -f *.[oads] *~ *.tokens *Listener.py *Parser.py *Lexer.py
	rm -rf __pycache__ generated_* test_* CUnit* *.dot


